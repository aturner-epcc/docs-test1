


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>Scheduler - ARCHER2 User Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.947af8d5.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/archer2.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-jobs-on-archer2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="ARCHER2 User Documentation" class="md-header-nav__button md-logo" aria-label="ARCHER2 User Documentation">
      
  <img src="../../images/archer2_white_transparent.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            ARCHER2 User Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Scheduler
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ARCHER2-HPC/archer2-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ARCHER2-HPC/archer2-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Documentation overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../quick-start/quickstart-users/" class="md-tabs__link">
          Quickstart
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../connecting/" class="md-tabs__link md-tabs__link--active">
          User and Best Practice Guide
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ARCHER2 User Documentation" class="md-nav__button md-logo" aria-label="ARCHER2 User Documentation">
      
  <img src="../../images/archer2_white_transparent.png" alt="logo">

    </a>
    ARCHER2 User Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ARCHER2-HPC/archer2-docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ARCHER2-HPC/archer2-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Documentation overview" class="md-nav__link">
      Documentation overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quickstart
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Quickstart" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Quickstart
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../quick-start/quickstart-users/" title="Quickstart for users" class="md-nav__link">
      Quickstart for users
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../quick-start/quickstart-developers/" title="Quickstart for developers" class="md-nav__link">
      Quickstart for developers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      User and Best Practice Guide
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="User and Best Practice Guide" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        User and Best Practice Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../connecting/" title="Connecting to ARCHER2" class="md-nav__link">
      Connecting to ARCHER2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data/" title="Data" class="md-nav__link">
      Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sw-environment/" title="Sw environment" class="md-nav__link">
      Sw environment
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Scheduler
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Scheduler" class="md-nav__link md-nav__link--active">
      Scheduler
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-slurm-commands" class="md-nav__link">
    Basic Slurm commands
  </a>
  
    <nav class="md-nav" aria-label="Basic Slurm commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sinfo-information-on-resources" class="md-nav__link">
    sinfo: information on resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sbatch-submitting-jobs" class="md-nav__link">
    sbatch: submitting jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#squeue-monitoring-jobs" class="md-nav__link">
    squeue: monitoring jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scancel-deleting-jobs" class="md-nav__link">
    scancel: deleting jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-limits" class="md-nav__link">
    Resource Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slurm-error-messages" class="md-nav__link">
    Slurm error messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-queued-reasons" class="md-nav__link">
    Slurm queued reasons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-from-slurm-jobs" class="md-nav__link">
    Output from Slurm jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-resources-in-job-scripts" class="md-nav__link">
    Specifying resources in job scripts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#srun-launching-parallel-jobs" class="md-nav__link">
    srun: Launching parallel jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-job-submission-scripts" class="md-nav__link">
    Example job submission scripts
  </a>
  
    <nav class="md-nav" aria-label="Example job submission scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job-submission-script-for-mpi-parallel-job" class="md-nav__link">
    Example: job submission script for MPI parallel job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-job-submission-script-for-mpiopenmp-mixed-mode-parallel-job" class="md-nav__link">
    Example: job submission script for MPI+OpenMP (mixed mode) parallel job
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-arrays" class="md-nav__link">
    Job arrays
  </a>
  
    <nav class="md-nav" aria-label="Job arrays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-script-for-a-job-array" class="md-nav__link">
    Job script for a job array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitting-a-job-array" class="md-nav__link">
    Submitting a job array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-chaining" class="md-nav__link">
    Job chaining
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-jobs-salloc" class="md-nav__link">
    Interactive Jobs: salloc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reservations" class="md-nav__link">
    Reservations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-for-job-submission" class="md-nav__link">
    Best practices for job submission
  </a>
  
    <nav class="md-nav" aria-label="Best practices for job submission">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do-not-run-production-jobs-in-home" class="md-nav__link">
    Do not run production jobs in /home
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-limits" class="md-nav__link">
    Time Limits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-running-jobs" class="md-nav__link">
    Long Running Jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-performance" class="md-nav__link">
    I/O performance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-jobs" class="md-nav__link">
    Large Jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-locality" class="md-nav__link">
    Network Locality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-placement" class="md-nav__link">
    Process Placement
  </a>
  
    <nav class="md-nav" aria-label="Process Placement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default" class="md-nav__link">
    Default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpich_rank_reorder_method" class="md-nav__link">
    MPICH_RANK_REORDER_METHOD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#huge-pages" class="md-nav__link">
    Huge pages
  </a>
  
    <nav class="md-nav" aria-label="Huge pages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-huge-pages" class="md-nav__link">
    When to Use Huge Pages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-avoid-huge-pages" class="md-nav__link">
    When to Avoid Huge Pages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../io/" title="Io" class="md-nav__link">
      Io
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-environment/" title="Dev environment" class="md-nav__link">
      Dev environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../containers/" title="Containers" class="md-nav__link">
      Containers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analysis/" title="Analysis" class="md-nav__link">
      Analysis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tuning/" title="Tuning" class="md-nav__link">
      Tuning
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#basic-slurm-commands" class="md-nav__link">
    Basic Slurm commands
  </a>
  
    <nav class="md-nav" aria-label="Basic Slurm commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sinfo-information-on-resources" class="md-nav__link">
    sinfo: information on resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sbatch-submitting-jobs" class="md-nav__link">
    sbatch: submitting jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#squeue-monitoring-jobs" class="md-nav__link">
    squeue: monitoring jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scancel-deleting-jobs" class="md-nav__link">
    scancel: deleting jobs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resource-limits" class="md-nav__link">
    Resource Limits
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#slurm-error-messages" class="md-nav__link">
    Slurm error messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slurm-queued-reasons" class="md-nav__link">
    Slurm queued reasons
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-from-slurm-jobs" class="md-nav__link">
    Output from Slurm jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#specifying-resources-in-job-scripts" class="md-nav__link">
    Specifying resources in job scripts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#srun-launching-parallel-jobs" class="md-nav__link">
    srun: Launching parallel jobs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-job-submission-scripts" class="md-nav__link">
    Example job submission scripts
  </a>
  
    <nav class="md-nav" aria-label="Example job submission scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-job-submission-script-for-mpi-parallel-job" class="md-nav__link">
    Example: job submission script for MPI parallel job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-job-submission-script-for-mpiopenmp-mixed-mode-parallel-job" class="md-nav__link">
    Example: job submission script for MPI+OpenMP (mixed mode) parallel job
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-arrays" class="md-nav__link">
    Job arrays
  </a>
  
    <nav class="md-nav" aria-label="Job arrays">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#job-script-for-a-job-array" class="md-nav__link">
    Job script for a job array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#submitting-a-job-array" class="md-nav__link">
    Submitting a job array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-chaining" class="md-nav__link">
    Job chaining
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interactive-jobs-salloc" class="md-nav__link">
    Interactive Jobs: salloc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reservations" class="md-nav__link">
    Reservations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices-for-job-submission" class="md-nav__link">
    Best practices for job submission
  </a>
  
    <nav class="md-nav" aria-label="Best practices for job submission">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do-not-run-production-jobs-in-home" class="md-nav__link">
    Do not run production jobs in /home
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-limits" class="md-nav__link">
    Time Limits
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#long-running-jobs" class="md-nav__link">
    Long Running Jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io-performance" class="md-nav__link">
    I/O performance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#large-jobs" class="md-nav__link">
    Large Jobs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-locality" class="md-nav__link">
    Network Locality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#process-placement" class="md-nav__link">
    Process Placement
  </a>
  
    <nav class="md-nav" aria-label="Process Placement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default" class="md-nav__link">
    Default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mpich_rank_reorder_method" class="md-nav__link">
    MPICH_RANK_REORDER_METHOD
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#huge-pages" class="md-nav__link">
    Huge pages
  </a>
  
    <nav class="md-nav" aria-label="Huge pages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-huge-pages" class="md-nav__link">
    When to Use Huge Pages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-avoid-huge-pages" class="md-nav__link">
    When to Avoid Huge Pages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ARCHER2-HPC/archer2-docs/edit/master/docs/user-guide/scheduler.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="running-jobs-on-archer2">Running jobs on ARCHER2</h1>
<p>Warning</p>
<p>The ARCHER2 Service is not yet available. This documentation is in
development.</p>
<p>As with most HPC services, ARCHER2 uses a scheduler to manage access to
resources and ensure that the thousands of different users of system are
able to share the system and all get access to the resources they
require. ARCHER2 uses the Slurm software to schedule jobs.</p>
<p>Writing a submission script is typically the most convenient way to
submit your job to the scheduler. Example submission scripts (with
explanations) for the most common job types are provided below.</p>
<p>Interactive jobs are also available and can be particularly useful for
developing and debugging applications. More details are available below.</p>
<p>Hint</p>
<p>If you have any questions on how to run jobs on ARCHER2 do not hesitate
to contact the <a href="mailto:support@archer2.ac.uk">ARCHER2 Service Desk</a>.</p>
<p>You typically interact with Slurm by issuing Slurm commands from the
login nodes (to submit, check and cancel jobs), and by specifying Slurm
directives that describe the resources required for your jobs in job
submission scripts.</p>
<h2 id="basic-slurm-commands">Basic Slurm commands</h2>
<p>There are three key commands used to interact with the Slurm on the
command line:</p>
<ul>
<li><code>sinfo</code> - Get information on the partitions and resources available</li>
<li><code>sbatch jobscript.slurm</code> - Submit a job submission script (in this
    case called: <code>jobscript.slurm</code>) to the scheduler</li>
<li><code>squeue</code> - Get the current status of jobs submitted to the scheduler</li>
<li><code>scancel 12345</code> - Cancel a job (in this case with the job ID
    <code>12345</code>)</li>
</ul>
<p>We cover each of these commands in more detail below.</p>
<h3 id="sinfo-information-on-resources"><code>sinfo</code>: information on resources</h3>
<p><code>sinfo</code> is used to query information about available resources and
partitions. Without any options, <code>sinfo</code> lists the status of all
resources and partitions, e.g.</p>
<pre><code>sinfo

PARTITION       AVAIL  TIMELIMIT  NODES  STATE NODELIST
standard           up 2-00:00:00      1  fail* cn580
standard           up 2-00:00:00    128  down$ cn[96,579,793,814,1025-1044,1081-1088]
standard           up 2-00:00:00     26  maint cn[27,93-95,206,232,310,492,568,577-578,585-588,813,815-816,818,846,889,921-924,956]
standard           up 2-00:00:00      2   fail cn[274,871]
standard           up 2-00:00:00      4  down* cn[528,614,637,845]
standard           up 2-00:00:00   1034  alloc cn[1-26,28-38,40-58,62-86,88-92,97-174,176-205,207-231,233-273,275-309,311-333,335-341,344-371,373-376,378-413,415-452,454-489,493-513,515-527,529-532,535-539,541-550,554-561,563-567,569,572-576,581-584,589-595,598-601,603-613,615,617-620,623-631,633-636,638-647,651-659,661-678,680-687,690-695,697-716,718-736,738-775,777-790,792,794-812,817,819-844,847-852,854-870,872-888,890-920,925-955,957-977,980-1014,1016-1020,1023-1024,1045,1047-1070,1072-1080,1089-1105,1107-1152]
standard           up 2-00:00:00     26   idle cn[61,490-491,540,551-552,562,570,596,602,621,632,648-650,660,688-689,696,853,978-979,1015,1021-1022,1071]
</code></pre>
<h3 id="sbatch-submitting-jobs"><code>sbatch</code>: submitting jobs</h3>
<p><code>sbatch</code> is used to submit a job script to the job submission system.
The script will typically contain one or more <code>srun</code> commands to launch
parallel tasks.</p>
<p>When you submit the job, the scheduler provides the job ID, which is
used to identify this job in other Slurm commands and when looking at
resource usage in SAFE.</p>
<pre><code>sbatch test-job.slurm
Submitted batch job 12345
</code></pre>
<h3 id="squeue-monitoring-jobs"><code>squeue</code>: monitoring jobs</h3>
<p><code>squeue</code> without any options or arguments shows the current status of
all jobs known to the scheduler. For example:</p>
<pre><code>squeue
</code></pre>
<p>will list all jobs on ARCHER2.</p>
<p>The output of this is often overwhelmingly large. You can restrict the
output to just your jobs by adding the <code>-u $USER</code> option:</p>
<pre><code>squeue -u $USER
</code></pre>
<h3 id="scancel-deleting-jobs"><code>scancel</code>: deleting jobs</h3>
<p><code>scancel</code> is used to delete a jobs from the scheduler. If the job is
waiting to run it is simply cancelled, if it is a running job then it is
stopped immediately. You need to provide the job ID of the job you wish
to cancel/stop. For example:</p>
<pre><code>scancel 12345
</code></pre>
<p>will cancel (if waiting) or stop (if running) the job with ID <code>12345</code>.</p>
<h2 id="resource-limits">Resource Limits</h2>
<p>There are different resource limits on ARCHER2 for different purposes.</p>
<p>Note</p>
<p>Details on the resource limits will be added when the ARCHER2 system is
available.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="slurm-error-messages">Slurm error messages</h3>
<p>Note</p>
<p>More information on common error messages will be added when the ARCHER2
system is available.</p>
<h3 id="slurm-queued-reasons">Slurm queued reasons</h3>
<p>Note</p>
<p>Explanations of the reasons for jobs being queued and not running will
be added when the ARCHER2 system is available.</p>
<h2 id="output-from-slurm-jobs">Output from Slurm jobs</h2>
<p>Slurm places standard output (STDOUT) and standard error (STDERR) for
each job in the file <code>slurm_&lt;JobID&gt;.out</code>. This file appears in the job's
working directory once your job starts running.</p>
<p>Note</p>
<p>This file is plain text and can contain useful information to help
debugging if a job is not working as expected. The ARCHER2 Service Desk
team will often ask you to provide the contents of this file if oyu
contact them for help with issues.</p>
<h2 id="specifying-resources-in-job-scripts">Specifying resources in job scripts</h2>
<p>You specify the resources you require for your job using directives at
the top of your job submission script using lines that start with the
directive <code>#SBATCH</code>.</p>
<p>Note</p>
<p>Options provided using <code>#SBATCH</code> directives can also be specified as
command line options to <code>srun</code>.</p>
<p>If you do not specify any options, then the default for each option will
be applied. As a minimum, all job submissions must specify the budget
that they wish to charge the job too with the option:</p>
<blockquote>
<ul>
<li><code>--account=&lt;budgetID&gt;</code> your budget ID is usually something like
    <code>t01</code> or <code>t01-test</code>. You can see which budget codes you can charge
    to in SAFE.</li>
</ul>
</blockquote>
<p>Other common options that are used are:</p>
<blockquote>
<ul>
<li><code>--time=&lt;hh:mm:ss&gt;</code> the maximum walltime for your job. <em>e.g.</em> For
    a 6.5 hour walltime, you would use <code>--time=6:30:0</code>.</li>
<li><code>--job-name=&lt;jobjob-name&gt;</code> set a job-name for the job to help
    identify it in Slurm command output.</li>
</ul>
</blockquote>
<p>In addition, parallel jobs will also need to specify how many nodes,
parallel processes and threads they require.</p>
<blockquote>
<ul>
<li><code>--nodes=&lt;nodes&gt;</code> the number of nodes to use for the job.</li>
<li><code>--tasks-per-node=&lt;processes per node&gt;</code> the number of parallel
    processes (e.g. MPI ranks) per node.</li>
<li><code>--cpus-per-task=1</code> if you are using parallel processes only with
    no threading then you should set the number of CPUs (cores) per
    parallel process to 1. <strong>Note:</strong> if you are using threading (e.g.
    with OpenMP) then you will need to change this option as described
    below.</li>
</ul>
</blockquote>
<p>For parallel jobs that use threading (e.g. OpenMP), you will also need
to change the <code>--cpus-per-task</code> option.</p>
<blockquote>
<ul>
<li><code>--cpus-per-task=&lt;threads per task&gt;</code> the number of threads per
    parallel process (e.g. number of OpenMP threads per MPI task for
    hybrid MPI/OpenMP jobs). <strong>Note:</strong> you must also set the
    <code>OMP_NUM_THREADS</code> environment variable if using OpenMP in your
    job.</li>
</ul>
</blockquote>
<p>Note</p>
<p>For parallel jobs, ARCHER2 operates in a <em>node exclusive</em> way. This
means that you are assigned resources in the units of full compute nodes
for your jobs (<em>i.e.</em> 128 cores) and that no other user can share those
compute nodes with you. Hence, the minimum amount of resource you can
request for a parallel job is 1 node (or 128 cores).</p>
<h2 id="srun-launching-parallel-jobs"><code>srun</code>: Launching parallel jobs</h2>
<p>If you are running parallel jobs, your job submission script should
contain one or more <code>srun</code> commands to launch the parallel executable
across the compute nodes.</p>
<p>Warning</p>
<p>To ensure that processes and threads are correctly mapped (or <em>pinned</em>)
to cores, you should always specify <span
class="title-ref">--cpu-bind=cores</span> option to <span
class="title-ref">srun</span>.</p>
<h2 id="example-job-submission-scripts">Example job submission scripts</h2>
<p>A subset of example job submission scripts are included in full below.
You can also download these examples at:</p>
<h3 id="example-job-submission-script-for-mpi-parallel-job">Example: job submission script for MPI parallel job</h3>
<p>A simple MPI job submission script to submit a job using 4 compute nodes
and 128 MPI ranks per node for 20 minutes would look like:</p>
<pre><code>#!/bin/bash

# Slurm job options (job-name, compute nodes, job time)
#SBATCH --job-name=Example_MPI_Job
#SBATCH --time=0:20:0
#SBATCH --nodes=4
#SBATCH --tasks-per-node=128
#SBATCH --cpus-per-task=1

# Replace [budget code] below with your budget code (e.g. t01)
#SBATCH --account=[budget code]

# Set the number of threads to 1
#   This prevents any threaded system libraries from automatically 
#   using threading.
export OMP_NUM_THREADS=1

# Launch the parallel job
#   Using 1024 MPI processes and 128 MPI processes per node
#   srun picks up the distribution from the sbatch options
srun --cpu-bind=cores ./my_mpi_executable.x
</code></pre>
<p>This will run your executable "my_mpi_executable.x" in parallel on
1024 MPI processes using 4 nodes (128 cores per node, i.e. not using
hyper-threading). Slurm will allocate 4 nodes to your job and srun will
place 128 MPI processes on each node (one per physical core).</p>
<p>See above for a more detailed discussion of the different <code>sbatch</code>
options</p>
<h3 id="example-job-submission-script-for-mpiopenmp-mixed-mode-parallel-job">Example: job submission script for MPI+OpenMP (mixed mode) parallel job</h3>
<p>Mixed mode codes that use both MPI (or another distributed memory
parallel model) and OpenMP should take care to ensure that the shared
memory portion of the process/thread placement does not span more than
one node. This means that the number of shared memory threads should be
a factor of 128.</p>
<p>In the example below, we are using 4 nodes for 6 hours. There are 32 MPI
processes in total (8 MPI processes per node) and 16 OpenMP threads per
MPI process. This results in all 128 physical cores per node being used.</p>
<p>Note</p>
<p>Note the use of the <code>export OMP_PLACES=cores</code> environment option and the
<code>--hint=nomultithread</code> and <code>--distribution=block:block</code> options to
<code>srun</code>to generate the correct pinning.</p>
<pre><code>#!/bin/bash

# Slurm job options (job-name, compute nodes, job time)
#SBATCH --job-name=Example_MPI_Job
#SBATCH --time=0:20:0
#SBATCH --nodes=4
#SBATCH --ntasks=32
#SBATCH --tasks-per-node=8
#SBATCH --cpus-per-task=16

# Replace [budget code] below with your project code (e.g. t01)
#SBATCH --account=[budget code]

# Set the number of threads to 16 and specify placement
#   There are 16 OpenMP threads per MPI process
#   We want one thread per physical core
export OMP_NUM_THREADS=16
export OMP_PLACES=cores

# Launch the parallel job
#   Using 32 MPI processes
#   8 MPI processes per node
#   16 OpenMP threads per MPI process
#   Additional srun options to pin one thread per physical core
srun --hint=nomultithread --distribution=block:block ./my_mixed_executable.x arg1 arg2
</code></pre>
<h2 id="job-arrays">Job arrays</h2>
<p>The Slurm job scheduling system offers the <em>job array</em> concept, for
running collections of almost-identical jobs. For example, running the
same program several times with different arguments or input data.</p>
<p>Each job in a job array is called a <em>subjob</em>. The subjobs of a job array
can be submitted and queried as a unit, making it easier and cleaner to
handle the full set, compared to individual jobs.</p>
<p>All subjobs in a job array are started by running the same job script.
The job script also contains information on the number of jobs to be
started, and Slurm provides a subjob index which can be passed to the
individual subjobs or used to select the input data per subjob.</p>
<h3 id="job-script-for-a-job-array">Job script for a job array</h3>
<p>As an example, the following script runs 56 subjobs, with the subjob
index as the only argument to the executable. Each subjob requests a
single node and uses all 128 cores on the node by placing 1 MPI process
per core and specifies 4 hours maximum runtime per subjob:</p>
<pre><code>#!/bin/bash
# Slurm job options (job-name, compute nodes, job time)
#SBATCH --job-name=Example_Array_Job
#SBATCH --time=0:20:0
#SBATCH --nodes=4
#SBATCH --tasks-per-node=128
#SBATCH --cpus-per-task=1
#SBATCH --array=0-55

# Replace [budget code] below with your budget code (e.g. t01)
#SBATCH --account=[budget code]

# Set the number of threads to 1
#   This prevents any threaded system libraries from automatically 
#   using threading.
export OMP_NUM_THREADS=1

srun --cpu-bind=cores /path/to/exe $Slurm_ARRAY_TASK_ID
</code></pre>
<h3 id="submitting-a-job-array">Submitting a job array</h3>
<p>Job arrays are submitted using <code>sbatch</code> in the same way as for standard
jobs:</p>
<pre><code>sbatch job_script.pbs
</code></pre>
<h2 id="job-chaining">Job chaining</h2>
<p>Job dependencies can be used to construct complex pipelines or chain
together long simulations requiring multiple steps.</p>
<p>Note</p>
<p>The <code>--parsable</code> option to <code>sbatch</code> can simplify working with job
dependencies. It returns the job ID in a format that can be used as the
input to other commands.</p>
<p>For example:</p>
<pre><code>jobid=$(sbatch --parsable first_job.sh)
sbatch --dependency=afterok:$jobid second_job.sh
</code></pre>
<p>or for a longer chain:</p>
<pre><code>jobid1=$(sbatch --parsable first_job.sh)
jobid2=$(sbatch --parsable --dependency=afterok:$jobid1 second_job.sh)
jobid3=$(sbatch --parsable --dependency=afterok:$jobid1 third_job.sh)
sbatch --dependency=afterok:$jobid2,afterok:$jobid3 last_job.sh
</code></pre>
<h2 id="interactive-jobs-salloc">Interactive Jobs: <code>salloc</code></h2>
<p>When you are developing or debugging code you often want to run many
short jobs with a small amount of editing the code between runs. This
can be achieved by using the login nodes to run MPI but you may want to
test on the compute nodes (e.g. you may want to test running on multiple
nodes across the high performance interconnect). One of the best ways to
achieve this on ARCHER2 is to use interactive jobs.</p>
<p>An interactive job allows you to issue <code>srun</code> commands directly from the
command line without using a job submission script, and to see the
output from your program directly in the terminal.</p>
<p>You use the <code>salloc</code> command to reserve compute nodes for interactive
jobs.</p>
<p>To submit a request for an interactive job reserving 8 nodes (1024
physical cores) for 1 hour you would issue the following qsub command
from the command line:</p>
<pre><code>salloc --nodes=8 --tasks-per-node=128 --cpus-per-task=1 --time=1:0:0 --account=[budget code]
</code></pre>
<p>When you submit this job your terminal will display something like:</p>
<pre><code>salloc: Granted job allocation 24236
salloc: Waiting for resource configuration
salloc: Nodes nid000002 are ready for job
</code></pre>
<p>It may take some time for your interactive job to start. Once it runs
you will enter a standard interactive terminal session. Whilst the
interactive session lasts you will be able to run parallel jobs on the
compute nodes by issuing the <code>srun --cpu-bind=cores</code> command directly at
your command prompt using the same syntax as you would inside a job
script. The maximum number of nodes you can use is limited by resources
requested in the <code>salloc</code> command.</p>
<p>If you know you will be doing a lot of intensive debugging you may find
it useful to request an interactive session lasting the expected length
of your working session, say a full day.</p>
<p>Your session will end when you hit the requested walltime. If you wish
to finish before this you should use the <code>exit</code> command - this will
return you to your prompt before you issued the <code>salloc</code> command.</p>
<h2 id="reservations">Reservations</h2>
<p>The mechanism for submitting reservations on ARCHER2 has yet to be
specified.</p>
<h2 id="best-practices-for-job-submission">Best practices for job submission</h2>
<p>This guidance is adapted from <a href="https://docs.nersc.gov/jobs/best-practices/">the advice provided by
NERSC</a></p>
<h3 id="do-not-run-production-jobs-in-home">Do not run production jobs in /home</h3>
<p>As a general best practice, users should run production runs from the
<code>/work</code> file systems rather than the <code>/home</code> file systems.</p>
<p>The <code>/home</code> file system is designed for permanent and relatively small
storage. It is not tuned to perform well for parallel jobs and large
amounts of I/O. Home is perfect for storing files such as source codes
and shell scripts. Please note that while building software in /home is
generally OK, it is best to install dynamic libraries and binaries that
are used on compute nodes on the <code>/work</code> file systems for best
performance.</p>
<p>The <code>/work</code> file systems are designed for large, temporary storage,
particularly for I/O from parallel jobs running on the compute nodes and
large scale data analysis (although the solid state storage may provide
better performance in particular scenarios). Running jobs on the <code>/work</code>
file systems also helps to improve the responsiveness of the <code>/home</code>
file systems for all users.</p>
<h3 id="time-limits">Time Limits</h3>
<p>Due to backfill scheduling, short and variable-length jobs generally
start quickly resulting in much better job throughput. You can specify a
minimum time for your job with the <code>--time-min</code> option to SBATCH:</p>
<pre><code>#SBATCH --time-min=&lt;lower_bound&gt;
#SBATCH --time=&lt;upper_bound&gt;
</code></pre>
<p>Within your job script, you can get the time remaining in the job with
<code>squeue -h -j ${Slurm_JOBID} -o %L</code> to allow you to deal with
potentially varying runtimes when using this option.</p>
<h3 id="long-running-jobs">Long Running Jobs</h3>
<p>Simulations which must run for a long period of time achieve the best
throughput when composed of many small jobs using a checkpoint and
restart method chained together (see above for how to chain jobs
together). However, this method does occur a startup and shutdown
overhead for each job as the state is saved and loaded so you should
experiment to find the best balance between runtime (long runtimes
minimise the checkpoint/restart overheads) and throughput (short
runtimes maximise throughput).</p>
<h3 id="io-performance">I/O performance</h3>
<h3 id="large-jobs">Large Jobs</h3>
<p>Large jobs may take longer to start up. The <code>sbcast</code> command is
recommended for large jobs requesting over 1500 MPI tasks. By default,
Slurm reads the executable on the allocated compute nodes from the
location where it is installed; this may take long time when the file
system (where the executable resides) is slow or busy. The <code>sbcast</code>
command, the executable can be copied to the <code>/tmp</code> directory on each of
the compute nodes. Since <code>/tmp</code> is part of the memory on the compute
nodes, it can speed up the job startup time.</p>
<div class="highlight"><pre><span></span><code>sbcast --compress=lz4 /path/to/exe /tmp/exe
srun /tmp/exe
</code></pre></div>

<h3 id="network-locality">Network Locality</h3>
<p>For jobs which are sensitive to interconnect (MPI) performance and
utilize less than or equal to 256 nodes it is possible to request that
all nodes are in a single Slingshot dragonfly group.</p>
<p>Slurm has a concept of "switches" which on ARCHER2 are configured to map
to Slingshot groups (there are 256 nodes per group). Since this places
an additional constraint on the scheduler a maximum time to wait for the
requested topology can be specified. For example:</p>
<pre><code>sbatch --switches=1@60 job.sh``
</code></pre>
<h3 id="process-placement">Process Placement</h3>
<p>Several mechanisms exist to control process placement on ARCHER2.
Application performance can depend strongly on placement depending on
the communication pattern and other computational characteristics.</p>
<h4 id="default">Default</h4>
<p>The default is to place MPI tasks sequentially on nodes until the
maximum number of tasks is reached:</p>
<pre><code>salloc --nodes=8 --tasks-per-node=2 --cpus-per-task=1 --time=0:10:0 --account=t01

salloc: Granted job allocation 24236
salloc: Waiting for resource configuration
salloc: Nodes cn13 are ready for job

module load xthi
export OMP_NUM_THREADS=1
srun --cpu-bind=cores xthi

Hello from rank 0, thread 0, on nid000001. (core affinity = 0,128)
Hello from rank 1, thread 0, on nid000001. (core affinity = 16,144)
Hello from rank 2, thread 0, on nid000002. (core affinity = 0,128)
Hello from rank 3, thread 0, on nid000002. (core affinity = 16,144)
Hello from rank 4, thread 0, on nid000003. (core affinity = 0,128)
Hello from rank 5, thread 0, on nid000003. (core affinity = 16,144)
Hello from rank 6, thread 0, on nid000004. (core affinity = 0,128)
Hello from rank 7, thread 0, on nid000004. (core affinity = 16,144)
Hello from rank 8, thread 0, on nid000005. (core affinity = 0,128)
Hello from rank 9, thread 0, on nid000005. (core affinity = 16,144)
Hello from rank 10, thread 0, on nid000006. (core affinity = 0,128)
Hello from rank 11, thread 0, on nid000006. (core affinity = 16,144)
Hello from rank 12, thread 0, on nid000007. (core affinity = 0,128)
Hello from rank 13, thread 0, on nid000007. (core affinity = 16,144)
Hello from rank 14, thread 0, on nid000008. (core affinity = 0,128)
Hello from rank 15, thread 0, on nid000008. (core affinity = 16,144)
</code></pre>
<h4 id="mpich_rank_reorder_method"><code>MPICH_RANK_REORDER_METHOD</code></h4>
<p>The <code>MPICH_RANK_REORDER_METHOD</code> environment variable is used to specify
other types of MPI task placement. For example, setting it to 0 results
in a round-robin placement:</p>
<pre><code>salloc --nodes=8 --tasks-per-node=2 --cpus-per-task=1 --time=0:10:0 --account=t01

salloc: Granted job allocation 24236
salloc: Waiting for resource configuration
salloc: Nodes cn13 are ready for job

module load xthi
export OMP_NUM_THREADS=1
export MPICH_RANK_REORDER_METHOD=0
srun --cpu-bind=cores xthi

Hello from rank 0, thread 0, on nid000001. (core affinity = 0,128)
Hello from rank 1, thread 0, on nid000002. (core affinity = 0,128)
Hello from rank 2, thread 0, on nid000003. (core affinity = 0,128)
Hello from rank 3, thread 0, on nid000004. (core affinity = 0,128)
Hello from rank 4, thread 0, on nid000005. (core affinity = 0,128)
Hello from rank 5, thread 0, on nid000006. (core affinity = 0,128)
Hello from rank 6, thread 0, on nid000007. (core affinity = 0,128)
Hello from rank 7, thread 0, on nid000008. (core affinity = 0,128)
Hello from rank 8, thread 0, on nid000001. (core affinity = 16,144)
Hello from rank 9, thread 0, on nid000002. (core affinity = 16,144)
Hello from rank 10, thread 0, on nid000003. (core affinity = 16,144)
Hello from rank 11, thread 0, on nid000004. (core affinity = 16,144)
Hello from rank 12, thread 0, on nid000005. (core affinity = 16,144)
Hello from rank 13, thread 0, on nid000006. (core affinity = 16,144)
Hello from rank 14, thread 0, on nid000007. (core affinity = 16,144)
Hello from rank 15, thread 0, on nid000008. (core affinity = 16,144)
</code></pre>
<p>There are other modes available with the <code>MPICH_RANK_REORDER_METHOD</code>
environment variable, including one which lets the user provide a file
called <code>MPICH_RANK_ORDER</code> which contains a list of each task's placement
on each node. These options are described in detail in the <code>intro_mpi</code>
man page.</p>
<p><strong>grid_order</strong></p>
<p>For MPI applications which perform a large amount of nearest-neighbor
communication, e.g., stencil-based applications on structured grids,
Cray provides a tool in the <code>perftools-base</code> module called <code>grid_order</code>
which can generate a <code>MPICH_RANK_ORDER</code> file automatically by taking as
parameters the dimensions of the grid, core count, etc. For example, to
place MPI tasks in row-major order on a Cartesian grid of size $(4, 4,
4)$, using 32 tasks per node:</p>
<pre><code>module load perftools-base
grid_order -R -c 32 -g 4,4,4

# grid_order -R -Z -c 32 -g 4,4,4
# Region 3: 0,0,1 (0..63)
0,1,2,3,16,17,18,19,32,33,34,35,48,49,50,51,4,5,6,7,20,21,22,23,36,37,38,39,52,53,54,55
8,9,10,11,24,25,26,27,40,41,42,43,56,57,58,59,12,13,14,15,28,29,30,31,44,45,46,47,60,61,62,63
</code></pre>
<p>One can then save this output to a file called <code>MPICH_RANK_ORDER</code> and
then set <code>MPICH_RANK_REORDER_METHOD=3</code> before running the job, which
tells Cray MPI to read the <code>MPICH_RANK_ORDER</code> file to set the MPI task
placement. For more information, please see the man page
<code>man grid_order</code> (available when the <code>perftools-base</code> module is loaded).</p>
<h3 id="huge-pages">Huge pages</h3>
<p>Huge pages are virtual memory pages which are bigger than the default
page size of 4K bytes. Huge pages can improve memory performance for
common access patterns on large data sets since it helps to reduce the
number of virtual to physical address translations when compared to
using the default 4KB.</p>
<p>To use huge pages for an application (with the 2 MB huge pages as an
example):</p>
<pre><code>module load craype-hugepages2M
cc -o mycode.exe mycode.c
</code></pre>
<p>And also load the same huge pages module at runtime.</p>
<p>Warning</p>
<p>Due to the huge pages memory fragmentation issue, applications may get
<em>Cannot allocate memory</em> warnings or errors when there are not enough
hugepages on the compute node, such as: :</p>
<pre><code>libhugetlbfs [nid0000xx:xxxxx]: WARNING: New heap segment map at 0x10000000 failed: Cannot allocate memory``
</code></pre>
<p>By default, The verbosity level of libhugetlbfs <code>HUGETLB_VERBOSE</code> is set
to <code>0</code> on ARCHER2 to surpress debugging messages. Users can adjust this
value to obtain more information on huge pages use.</p>
<h4 id="when-to-use-huge-pages">When to Use Huge Pages</h4>
<ul>
<li>For MPI applications, map the static data and/or heap onto huge
    pages.</li>
<li>For an application which uses shared memory, which needs to be
    concurrently registered with the high speed network drivers for
    remote communication.</li>
<li>For SHMEM applications, map the static data and/or private heap onto
    huge pages.</li>
<li>For applications written in Unified Parallel C, Coarray Fortran, and
    other languages based on the PGAS programming model, map the static
    data and/or private heap onto huge pages.</li>
<li>For an application doing heavy I/O.</li>
<li>To improve memory performance for common access patterns on large
    data sets.</li>
</ul>
<h4 id="when-to-avoid-huge-pages">When to Avoid Huge Pages</h4>
<ul>
<li>Applications sometimes consist of many steering programs in addition
    to the core application. Applying huge page behavior to all
    processes would not provide any benefit and would consume huge pages
    that would otherwise benefit the core application. The runtime
    environment variable <code>HUGETLB_RESTRICT_EXE</code> can be used to specify
    the susbset of the programs to use hugepages.</li>
<li>For certain applications if using hugepages either causes issues or
    slows down performance. One such example is that when an application
    forks more subprocesses (such as pthreads) and these threads
    allocate memory, the newly allocated memory are the default 4 KB
    pages.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../sw-environment/" title="Sw environment" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sw environment
              </div>
            </div>
          </a>
        
        
          <a href="../io/" title="Io" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Io
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ARCHER2-HPC" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/ARCHER2_HPC" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/groups/13848871/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>